<<<<<<< HEAD
//procedure to get unconfirmed orders


DELIMITER $$

CREATE PROCEDURE GetUnconfirmedPayments()
BEGIN
    SELECT * 
    FROM `Order`
    WHERE confirm_payments = FALSE;
END$$

DELIMITER ;

//procedure to get confirmed orders


DELIMITER $$

CREATE PROCEDURE GetConfirmedPayments()
BEGIN
    SELECT * 
    FROM `Order`
    WHERE confirm_payments = 1;
END$$

DELIMITER 

//procedure to get all orders(Confirmed and Unconfirmed)

DELIMITER $$

CREATE PROCEDURE GetPayments()
BEGIN
    SELECT * 
    FROM `Order`;
   
END$$

DELIMITER ;

//procedure to get all train data


DELIMITER $$

CREATE PROCEDURE Gettrains()
BEGIN
    SELECT * 
    FROM `train`;
   
END$$

DELIMITER ;

// procedure to assign a train for a given order ID and updating the train delivery according to that

DELIMITER $$

CREATE PROCEDURE AssignTrainDelivery(
    IN p_order_id INT, 
    IN p_train_id INT
)
BEGIN
    -- Check if the payment is confirmed
    DECLARE v_nearest_store_id INT;
    DECLARE v_confirm_payments BOOLEAN;

    -- Fetch the payment status and nearest_store_id for the order
    SELECT confirm_payments, nearest_store_id
    INTO v_confirm_payments, v_nearest_store_id
    FROM `Order`
    WHERE order_id = p_order_id;

    -- If payment is confirmed, proceed with the updates
    IF v_confirm_payments = 1 THEN
        -- Update the Order table
        UPDATE `Order`
        SET train_delivery_id = p_train_id, 
            sent_by_train = 1
        WHERE order_id = p_order_id;

        -- Insert into the train_delivery table
        INSERT INTO train_delivery ( train_id, allocated_capacity,store_id)
        VALUES (v_nearest_store_id, p_train_id, 0);
        
    ELSE
        -- If payment is not confirmed, raise an error
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Payment not confirmed for this order.';
    END IF;
    
END$$

DELIMITER ;
=======
CREATE DEFINER=`root`@`localhost` PROCEDURE `RegisterFinanceManager`(
    IN fm_user_name VARCHAR(20),
    IN fm_password VARCHAR(16),
    IN fm_first_name VARCHAR(20),
    IN fm_last_name VARCHAR(20),
    IN fm_contact INT,
    IN fm_email VARCHAR(50)
)
BEGIN
    INSERT INTO financeandorder_manager (user_name, password, manager_first_name, manager_last_name, manager_contact, manager_email)
    VALUES (fm_user_name, fm_password, fm_first_name, fm_last_name, fm_contact, fm_email);
END
>>>>>>> 99a6dbd8e13e954b72aa9d93f279e3e2bcaa6926
